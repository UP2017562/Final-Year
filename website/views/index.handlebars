<section class="home-container">
    <div class="big-box">
        <h1>Welcome to Dynamic accessibility, Customize Web Pages!</h1>
        <p>This website allows you to enter a url and change that website to your needs! Simply login or create an account and enter the prefrences you want!</p>
    </div>
    {{#if isLoggedIn}}
    <form action="/go" method="post" class="url-input">
        <label for="url">Insert your URL here:</label>
        <input type="text" id="url" name="url" placeholder="Enter URL...">
        <button type="submit" class="go-button">Go!</button>
    </form>
    <!-- Add iframe for displaying the fetched source code -->
    <iframe id="source-preview" width="80%" height="600" style="border: 1px solid #ccc;"></iframe>
    {{else}}
    <p>Please <a href="/login">log in</a> to use this feature.</p>
    {{/if}}
</section>

<script>
    document.querySelector('.url-input').addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent form submission
        const url = document.querySelector('#url').value; // Get URL from the form

        // Fetch the source code and user preferences from the server
        fetch('/go', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ url }) // Send the URL to the server
        })
        .then(response => response.json()) // Get the response as JSON
        .then(data => {
            const iframe = document.getElementById('source-preview');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;

            // Write the source code into the iframe
            iframeDoc.open();
            iframeDoc.write(data.html);

            // Apply user preferences as CSS
            const style = iframeDoc.createElement('style');
            const preferences = data.preferences;
            style.textContent = `
                body {
                    font-family: ${preferences.font_style || 'Arial, sans-serif'};
                    font-size: ${preferences.font_size || 16}px;
                    color: ${preferences.font_colour || '#000000'};
                    background-color: ${preferences.colour_contrast ? '#000000' : '#ffffff'};
                }
                a {
                    color: ${preferences.colour_contrast ? '#1e90ff' : '#0000ff'};
                }`;
            iframeDoc.head.appendChild(style);

            iframeDoc.close();
        })
        .catch(error => console.error('Error loading source into iframe:', error));
    });
</script>

